<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parliamentary Scanner</title>
    <link rel="icon" type="image/svg+xml" href="/icon-no-bg (1).svg">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/parliscan-tokens.css">
    <link rel="stylesheet" href="/css/parliscan-components.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="ps-app">

    <!-- ===== Sidebar Navigation ===== -->
    <aside class="ps-sidebar">

        <!-- Logo block -->
        <div class="ps-sidebar__logo" onclick="toggleSidebar()" title="Toggle sidebar">
            <img src="/icon-no-bg (1).svg" class="ps-sidebar__logo-img" alt="ParliScan logo">
            <div class="ps-sidebar__logo-title">ParliScan</div>
        </div>

        <!-- Nav items — .tab-btn kept so existing switchTab() JS still works -->
        <nav class="ps-sidebar__nav">
            <button class="ps-sidebar__nav-item tab-btn active" data-tab="calendar" onclick="switchTab('calendar')" title="Calendar">
                <span class="ps-sidebar__nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                </span>
                <span class="ps-sidebar__nav-label">Calendar</span>
            </button>
            <button class="ps-sidebar__nav-item tab-btn" data-tab="scanner" onclick="switchTab('scanner')" title="Scanner">
                <span class="ps-sidebar__nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="15" r="1.5" fill="currentColor" stroke="none"/><path d="M7 10 A6 6 0 0 1 17 10"/><path d="M4 7 A10 10 0 0 1 20 7"/></svg>
                </span>
                <span class="ps-sidebar__nav-label">Scanner</span>
            </button>
            <button class="ps-sidebar__nav-item tab-btn" data-tab="record" onclick="switchTab('record')" title="Record">
                <span class="ps-sidebar__nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                </span>
                <span class="ps-sidebar__nav-label">Record</span>
                <span class="ps-sidebar__nav-beta">Beta</span>
            </button>
            <button class="ps-sidebar__nav-item tab-btn" data-tab="alerts" onclick="switchTab('alerts')" title="Alerts">
                <span class="ps-sidebar__nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                </span>
                <span class="ps-sidebar__nav-label">Alerts</span>
            </button>
            <button class="ps-sidebar__nav-item tab-btn" data-tab="topics" onclick="switchTab('topics')" title="Topics">
                <span class="ps-sidebar__nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
                </span>
                <span class="ps-sidebar__nav-label">Topics</span>
            </button>
        </nav>

        <!-- Sidebar collapse toggle -->
        <button class="ps-sidebar__toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
            <span class="ps-sidebar__toggle-icon">‹</span>
        </button>

        <!-- Footer: API status (moved from scanner controls row) -->
        <div class="ps-sidebar__footer">
            <span id="apiStatus" class="api-status api-status--checking" title="Checking AI classifier connection...">
                <span class="api-status-dot"></span>
                <span class="api-status-label">Checking API...</span>
            </span>
        </div>

    </aside>

    <!-- ===== Main content area ===== -->
    <main class="ps-main">

        <!-- ===== Scanner Tab ===== -->
        <div id="tab-scanner" style="display:none;">
            <div class="la-cal-header">
                <h2 class="la-cal-title">Scanner</h2>
            </div>
            <!-- Grouped Control Card -->
            <section class="control-group-card">
            <!-- Scan Controls -->
            <div id="controls">
                <div class="control-row">
                    <div class="date-picker-wrapper" id="datePickerWrapper">
                        <button class="date-picker-display placeholder" id="datePickerDisplay">Select date range</button>
                        <div class="calendar-dropdown" id="calendarDropdown"></div>
                        <input type="hidden" id="startDate">
                        <input type="hidden" id="endDate">
                    </div>
                    <button id="scanBtn" class="ps-btn ps-btn--primary">Scan</button>
                    <button id="cancelBtn" class="ps-btn ps-btn--ghost" style="display:none;">Cancel</button>
                </div>
            </div>

            <!-- Filter Bar: Sources + Topics -->
            <div class="ps-filter-bar">
                <div class="ps-chip-group" id="source-toggles">
                    <span class="ps-chip-group__label">SOURCES</span>
                    <div class="ps-chip-group__items">
                        <button class="ps-chip ps-chip--active" data-source="hansard" title="Records of debates in Commons and Lords">Hansard</button>
                        <button class="ps-chip ps-chip--active" data-source="written_questions" title="Questions tabled by MPs to government ministers">Written Qs</button>
                        <button class="ps-chip ps-chip--active" data-source="written_statements" title="Formal statements by ministers">Written Stmts</button>
                        <button class="ps-chip ps-chip--active" data-source="edms" title="Motions signed by MPs to show support for a cause">EDMs</button>
                        <button class="ps-chip ps-chip--active" data-source="bills" title="Proposed legislation being considered by Parliament">Bills</button>
                        <button class="ps-chip ps-chip--active" data-source="divisions" title="Recorded votes in the House of Commons">Divisions</button>
                    </div>
                </div>

                <div class="ps-chip-group">
                    <div class="ps-chip-group__header">
                        <span class="ps-chip-group__label">TOPICS</span>
                        <div style="display:flex;gap:4px;align-items:center;" onclick="event.stopPropagation()">
                            <button class="ps-btn ps-btn--ghost ps-btn--sm btn-undo disabled" id="undoBtn" onclick="undoLastAction()" title="Undo">&#8617;</button>
                            <span style="font-size:var(--ps-text-sm);color:var(--ps-text-muted);cursor:pointer;" id="topicToggleAllBtn" onclick="toggleAllTopicsBtn()">All</span>
                        </div>
                    </div>
                    <div class="ps-chip-group__items" id="topicChipGroup"></div>
                    <div class="topic-add-inline">
                        <input class="ps-input ps-input--sm" type="text" id="newTopicName" placeholder="New topic...">
                        <button id="addTopicBtn" class="ps-btn ps-btn--ghost ps-btn--sm">+ Add</button>
                    </div>
                </div>
            </div>

            </section>

            <!-- Progress -->
            <section id="progress-section" style="display:none;">
                <div class="progress-header">
                    <button class="btn-minimize" id="minimizeBtn" style="display:none;" onclick="toggleProgressContent()" title="Minimize">&#9660;</button>
                </div>
                <div id="progressContent">
                    <p id="progressLabel">Preparing scan...</p>
                    <div id="progressPanels" style="display:none;">
                        <div id="keywordProgress" class="keyword-progress-panel"></div>
                        <div id="pipelineStats" class="pipeline-stats-row"></div>
                        <div id="sourceCirclesRow" class="source-circles-row" style="display:none;"></div>
                    </div>
                </div>
            </section>

            <!-- Scan History -->
            <section id="history-section">
                <h2>Scan History</h2>
                <div id="historyList"></div>
            </section>

            <!-- Results -->
            <section id="results-section">
                <div class="results-header">
                    <h2>Results</h2>
                    <button id="exportBtn" class="ps-btn ps-btn--ghost ps-btn--sm" title="Export to Excel" style="display:inline-flex;align-items:center;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                </div>
                <div class="table-container ps-table-wrapper">
                    <table id="resultsTable" class="ps-table">
                        <thead>
                            <tr>
                                <th data-col="member_name">Name</th>
                                <th data-col="party">Party</th>
                                <th data-col="topics">Topic(s)</th>
                                <th data-col="summary">Summary</th>
                                <th data-col="forum">Source</th>
                                <th data-col="verbatim_quote">Quote / Action</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Audit Panel -->
            <section id="audit-section">
                <div class="section-header" id="auditToggle">
                    <h2>Discarded Items</h2>
                    <span class="toggle-icon">&#9660;</span>
                </div>
                <div id="auditSummary" class="audit-summary"></div>
                <div id="auditList" class="audit-container"></div>
            </section>
        </div>

        <!-- ===== Record Tab ===== -->
        <div id="tab-record" style="display:none;">
            <div class="la-cal-header">
                <h2 class="la-cal-title">Record</h2>
            </div>
            <section id="record-section">
                <div class="results-header">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <div class="ps-search ps-search--wide">
                            <input class="ps-search__input" type="text" id="masterSearchInput" placeholder="Search stakeholders…" oninput="filterMasterList()">
                        </div>
                        <button class="ps-btn ps-btn--ghost ps-btn--sm btn-undo disabled" id="masterUndoBtn" onclick="undoMasterDelete()" title="Undo delete" style="display:none;">&#8617;</button>
                        <button class="ps-btn ps-btn--ghost ps-btn--sm" title="Export to Excel" style="display:inline-flex;align-items:center;" onclick="window.location.href='/api/master/export'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container ps-table-wrapper">
                    <table id="masterTable" class="ps-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Party</th>
                                <th>Type</th>
                                <th>Constituency</th>
                                <th>Topics</th>
                                <th>Priority</th>
                                <th>Notes</th>
                                <th>Activities</th>
                                <th>Latest</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="masterTableBody"></tbody>
                    </table>
                </div>
                <p id="masterEmpty" class="empty-state" style="display:none;">No stakeholders yet. Add members from scan results using the + button.</p>
            </section>
        </div>

        <!-- ===== Calendar Tab ===== -->
        <div id="tab-lookahead">

            <div class="la-sticky-header" id="laStickyHeader">

            <!-- Calendar header -->
            <div class="la-cal-header">
                <h2 class="la-cal-title">Calendar</h2>
                <div class="la-cal-controls">
                    <div class="la-cal-nav">
                        <button class="la-cal-today-btn" id="laToday" title="Go to this week">
                            <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><circle cx="12" cy="16" r="1.5" fill="currentColor" stroke="none"/></svg>
                        </button>
                        <button class="la-cal-nav-btn" id="laPrevWeek" title="Previous week">&#8249;</button>
                        <button class="la-cal-nav-btn" id="laNextWeek" title="Next week">&#8250;</button>
                        <span class="la-cal-date-label" id="laDateLabel"></span>
                    </div>
                    <div class="la-cal-spacer"></div>
                    <!-- View toggle (segmented control) -->
                    <div class="la-view-toggle">
                        <button class="la-view-btn active" data-view="week">Week</button>
                        <button class="la-view-btn" data-view="list">List</button>
                    </div>
                    <!-- Filter toggle -->
                    <button class="la-filter-btn" id="laFilterBtn" title="Filters">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                    </button>
                    <!-- Refresh -->
                    <button class="la-refresh-btn" id="laRefreshBtn" title="Refresh from Parliament">&#8635;</button>
                    <!-- Search -->
                    <div class="la-search-wrap">
                        <svg class="la-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        <input type="search" id="laSearch" class="la-search-input" placeholder="" autocomplete="off" spellcheck="false">
                    </div>
                </div>
            </div>

            <!-- Collapsible filter panel (rendered by JS) -->
            <div id="laFilterPanel" class="la-filter-panel"></div>

            <!-- Info bar (rendered by JS) -->
            <div id="laInfoBar" class="la-info-bar"></div>

            </div><!-- /.la-sticky-header -->

            <!-- Week view (time grid, rendered by JS) -->
            <div id="la-week-view" class="la-time-grid-outer"></div>

            <!-- List view (grouped rows, rendered by JS) -->
            <div id="la-list-view" class="la-list-outer" style="display:none;"></div>

        </div>

        <!-- ===== Alerts Tab ===== -->
        <div id="tab-alerts" style="display:none;">
            <div class="la-cal-header">
                <h2 class="la-cal-title">Alerts</h2>
            </div>
            <!-- Alert List -->
            <section id="alertFormList" class="control-group-card">
                <div class="results-header" style="margin-bottom:12px;">
                    <div class="alert-new-dropdown" id="alertNewDropdown">
                        <button class="ps-btn ps-btn--secondary" id="alertNewBtn" onclick="toggleAlertDropdown(event)">
                            New Alert
                        </button>
                        <div class="alert-new-menu" id="alertNewMenu" style="display:none;">
                            <button onclick="selectAlertType('scan')">Scan Alert</button>
                            <button onclick="selectAlertType('lookahead')">Calendar Alert</button>
                        </div>
                    </div>
                </div>
                <!-- Desktop table view -->
                <div class="table-container alerts-desktop ps-table-wrapper">
                    <table id="alertsTable" class="ps-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Schedule</th>
                                <th>Recipients</th>
                                <th>Last Run</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="alertsListBody"></tbody>
                    </table>
                </div>
                <!-- Mobile card view -->
                <div class="alerts-mobile" id="alertsCardList"></div>
            </section>

            <!-- Alert Create/Edit Form (hidden by default) -->
            <section id="alertFormSection" class="control-group-card" style="display:none;">
                <div class="results-header" style="margin-bottom:16px;">
                    <h2 id="alertFormTitle">Create New Alert</h2>
                    <button class="ps-btn ps-btn--ghost ps-btn--sm" onclick="hideAlertForm()">Cancel</button>
                </div>

                <div class="alert-form-grid">
                    <!-- Left column: Basic config -->
                    <div>
                        <div style="margin-bottom:12px;">
                            <label class="source-label" style="margin-bottom:4px;">Alert Name</label>
                            <input class="ps-input" type="text" id="alertName" placeholder="e.g. Weekly AI Scan">
                        </div>

                        <div style="margin-bottom:12px;">
                            <label class="source-label" style="margin-bottom:4px;">Alert Type</label>
                            <select class="ps-select" id="alertType" onchange="_updateFormVisibility()">
                                <option value="scan">Scan (past activity)</option>
                                <option value="lookahead">Calendar (upcoming events)</option>
                            </select>
                        </div>

                        <div class="alert-schedule-row">
                            <div style="flex:1">
                                <label class="source-label" style="margin-bottom:4px;">Cadence</label>
                                <select class="ps-select" id="alertCadence" onchange="_updateFormVisibility()">
                                    <option value="weekly">Weekly</option>
                                    <option value="daily">Daily</option>
                                </select>
                            </div>
                            <div style="flex:1" id="alertDayOfWeekRow">
                                <label class="source-label" style="margin-bottom:4px;">Day</label>
                                <select class="ps-select" id="alertDayOfWeek">
                                    <option value="monday">Monday</option>
                                    <option value="tuesday">Tuesday</option>
                                    <option value="wednesday">Wednesday</option>
                                    <option value="thursday">Thursday</option>
                                    <option value="friday">Friday</option>
                                    <option value="saturday">Saturday</option>
                                    <option value="sunday">Sunday</option>
                                </select>
                            </div>
                            <div style="flex:1">
                                <label class="source-label" style="margin-bottom:4px;">Time (UTC)</label>
                                <input class="ps-input" type="time" id="alertSendTime" value="09:00">
                            </div>
                        </div>

                        <div style="margin-bottom:12px;">
                            <label class="source-label" style="margin-bottom:4px;">Timezone</label>
                            <select class="ps-select" id="alertTimezone">
                                <option value="Europe/London">Europe/London (GMT/BST)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>

                        <div style="margin-bottom:12px;">
                            <label class="source-label" style="margin-bottom:4px;">Recipients</label>
                            <div class="ps-email-input" id="alertRecipientsContainer">
                                <div id="alertRecipientTags" class="ps-email-input__tags"></div>
                                <div class="ps-email-input__row">
                                    <input class="ps-email-input__field" type="email" id="alertRecipientInput"
                                           placeholder="email@example.com — press Enter to add" autocomplete="off"
                                           onkeydown="if(event.key==='Enter'){event.preventDefault();addAlertRecipient();}">
                                </div>
                                <div class="ps-email-input__error" id="alertRecipientError"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Right column: Type-specific config -->
                    <div>
                        <!-- Scan config -->
                        <div id="alertScanConfig">
                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:4px;">Scan Period (days back)</label>
                                <input class="ps-input" type="number" id="alertScanPeriod" value="7" min="1" max="90" style="width:100px;">
                            </div>

                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:6px;">Topics</label>
                                <div id="alertTopicCheckboxes" class="ps-chip-group__items"></div>
                            </div>

                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:6px;">Sources</label>
                                <div id="alertSourceCheckboxes" class="ps-chip-group__items"></div>
                            </div>
                        </div>

                        <!-- Lookahead config -->
                        <div id="alertLookaheadConfig" style="display:none;">
                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:4px;">Days Ahead</label>
                                <input class="ps-input" type="number" id="alertLookaheadDays" value="7" min="1" max="90" style="width:100px;">
                            </div>

                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:6px;">Event Types</label>
                                <div id="alertEventTypeCheckboxes" class="ps-chip-group__items"></div>
                            </div>

                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:6px;">Houses</label>
                                <div id="alertHouseCheckboxes" class="ps-chip-group__items"></div>
                            </div>

                            <div style="margin-bottom:12px;">
                                <label class="source-label" style="margin-bottom:6px;">Topics (for keyword filtering)</label>
                                <div id="alertLookaheadTopicCheckboxes" class="ps-chip-group__items"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display:flex;gap:12px;margin-top:16px;">
                    <button class="ps-btn ps-btn--primary" onclick="saveAlert()">Save Alert</button>
                    <button class="ps-btn ps-btn--ghost ps-btn--sm" onclick="hideAlertForm()">Cancel</button>
                </div>
            </section>

            <!-- Alert Run History Panel (hidden by default) -->
            <section id="alertHistoryPanel" class="control-group-card" style="display:none;">
                <div class="results-header" style="margin-bottom:12px;">
                    <h2 id="alertHistoryTitle">Run History</h2>
                    <button class="ps-btn ps-btn--ghost ps-btn--sm" onclick="hideAlertHistory()">Close</button>
                </div>
                <div class="table-container ps-table-wrapper">
                    <table id="alertHistoryTable" class="ps-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Recipients</th>
                                <th>Results</th>
                                <th>Error</th>
                            </tr>
                        </thead>
                        <tbody id="alertHistoryBody"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- ===== Topics Tab ===== -->
        <div id="tab-topics" style="display:none;">
            <div class="la-cal-header" style="border-bottom:none;">
                <h2 class="la-cal-title">Topics</h2>
            </div>
            <div class="topics-page-add">
                <input class="ps-input" type="text" id="topicsPageNewName" placeholder="New topic name...">
                <button class="ps-btn ps-btn--secondary ps-btn--sm" id="topicsPageAddBtn">+ Add Topic</button>
                <button class="ps-btn ps-btn--ghost ps-btn--sm btn-undo disabled" id="topicsPageUndoBtn" onclick="undoLastAction()" title="Undo" style="margin-left:auto;">&#8617;</button>
            </div>
            <div id="topicsPageGrid" class="topics-page-grid"></div>
            <a href="/api/topics/export" download style="display:inline-block;margin-top:12px;font-size:0.85rem;color:var(--text-light);text-decoration:underline;background:none;border:none;cursor:pointer;">Export</a>
        </div>

    </main>

    <script src="/js/app.js"></script>
    <script src="/js/datepicker.js"></script>
    <script src="/js/topics.js"></script>
    <script src="/js/scanner.js"></script>
    <script src="/js/results.js"></script>
    <script src="/js/master.js"></script>
    <script src="/js/lookahead.js"></script>
    <script src="/js/alerts.js"></script>

    <!-- Topic keyword popover — lives at body level so it's never hidden by a tab's display:none -->
    <div id="topicPopover" class="topic-popover" style="display:none;">
        <div class="topic-popover__header">
            <span class="topic-popover__title"></span>
            <button class="topic-popover__delete" id="topicPopoverDelete" title="Delete topic">Delete topic</button>
        </div>
        <div class="topic-popover__keywords" id="topicPopoverKeywords"></div>
        <div class="topic-popover__add">
            <input class="ps-input" type="text" id="topicPopoverInput" placeholder="Add keyword...">
            <button class="ps-btn ps-btn--ghost ps-btn--sm" onclick="addKeywordFromPopover()">Add</button>
        </div>
    </div>
</body>
</html>
