<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parliamentary Scanner</title>
    <link rel="icon" type="image/svg+xml" href="/icon-no-bg (1).svg">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header>
        <img src="/icon-no-bg (1).svg" alt="Logo" class="header-logo">
        <h1>Parliamentary Scanner</h1>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="lookahead" onclick="switchTab('lookahead')">Look Ahead</button>
        <button class="tab-btn" data-tab="scanner" onclick="switchTab('scanner')">Scanner</button>
        <button class="tab-btn" data-tab="record" onclick="switchTab('record')">Record</button>
    </nav>

    <!-- Sidebar Table of Contents -->
    <nav class="page-toc" id="pageToc">
        <a class="toc-link active" href="#controls">Search</a>
        <a class="toc-link" href="#topic-manager">Topics & Keywords</a>
        <a class="toc-link" href="#history-section">Scan History</a>
        <a class="toc-link" href="#results-section">Results</a>
        <a class="toc-link" href="#audit-section" id="tocAuditLink" style="display:none;">Discarded Items</a>
    </nav>

    <main>
        <!-- ===== Scanner Tab ===== -->
        <div id="tab-scanner" style="display:none;">
            <!-- Grouped Control Card -->
            <section class="control-group-card">
            <!-- Scan Controls -->
            <div id="controls">
                <div class="control-row">
                    <div class="date-picker-wrapper" id="datePickerWrapper">
                        <button class="date-picker-display placeholder" id="datePickerDisplay">Select date range</button>
                        <div class="calendar-dropdown" id="calendarDropdown"></div>
                        <input type="hidden" id="startDate">
                        <input type="hidden" id="endDate">
                    </div>
                    <button id="scanBtn" class="btn btn-scan">Scan</button>
                    <button id="cancelBtn" class="btn btn-danger" style="display:none;">Cancel</button>
                </div>
            </div>

            <hr class="control-divider">

            <!-- Source Toggles -->
            <div id="source-toggles">
                <span class="source-label">SOURCES:</span>
                <div class="source-toggle-row">
                    <button class="source-btn active" data-source="hansard" data-description="Records of debates in Commons and Lords">Hansard</button>
                    <button class="source-btn active" data-source="written_questions" data-description="Questions tabled by MPs to government ministers">Written Questions</button>
                    <button class="source-btn active" data-source="written_statements" data-description="Formal statements by ministers">Written Statements</button>
                    <button class="source-btn active" data-source="edms" data-description="Motions signed by MPs to show support for a cause">EDMs</button>
                    <button class="source-btn active" data-source="bills" data-description="Proposed legislation being considered by Parliament">Bills</button>
                    <button class="source-btn active" data-source="divisions" data-description="Recorded votes in the House of Commons">Divisions</button>
                </div>
            </div>

            <hr class="control-divider">

            <!-- Topic Manager -->
            <div id="topic-manager">
                <div class="section-header" id="topicToggle">
                    <span class="source-label">TOPICS & KEYWORDS:</span>
                    <div style="display:flex;align-items:center;gap:12px">
                        <div class="btn-split" onclick="event.stopPropagation()">
                            <button class="btn-split-left" id="selectAllTopics" onclick="toggleAllTopics(true)">All</button>
                            <button id="selectNoneTopics" onclick="toggleAllTopics(false)">None</button>
                        </div>
                        <button class="btn-undo disabled" id="undoBtn" onclick="event.stopPropagation(); undoLastAction()" title="Undo">&#8617;</button>
                        <span class="toggle-icon">&#9660;</span>
                    </div>
                </div>
                <div id="topicPills" class="topic-pills"></div>
                <div id="topicList" class="topic-container"></div>
                <div class="topic-add">
                    <input type="text" id="newTopicName" placeholder="New topic name...">
                    <button id="addTopicBtn" class="btn btn-small">Add Topic</button>
                </div>
            </div>
            </section>

            <!-- Progress -->
            <section id="progress-section" style="display:none;">
                <div class="progress-header">
                    <div class="stage-indicator" id="stageIndicator">
                        <div class="stage" data-stage="1">
                            <div class="stage-circle">1</div>
                            <span class="stage-label">Keyword Search</span>
                        </div>
                        <div class="stage-line"></div>
                        <div class="stage" data-stage="2">
                            <div class="stage-circle">2</div>
                            <span class="stage-label">Classification</span>
                        </div>
                        <div class="stage-line"></div>
                        <div class="stage" data-stage="3">
                            <div class="stage-circle">3</div>
                            <span class="stage-label">Storing Results</span>
                        </div>
                    </div>
                    <button class="btn-minimize" id="minimizeBtn" style="display:none;" onclick="toggleProgressContent()" title="Minimize">&#9660;</button>
                </div>
                <div id="progressContent">
                    <p id="progressLabel">Preparing scan...</p>
                    <div id="progressPanels" style="display:none;">
                        <div id="keywordProgress" class="keyword-progress-panel"></div>
                        <div id="pipelineStats" class="pipeline-stats-row"></div>
                        <div id="sourceCirclesRow" class="source-circles-row" style="display:none;"></div>
                    </div>
                </div>
            </section>

            <!-- Scan History -->
            <section id="history-section">
                <h2>Scan History</h2>
                <div id="historyList"></div>
            </section>

            <!-- Results -->
            <section id="results-section">
                <div class="results-header">
                    <h2>Results</h2>
                    <button id="exportBtn" class="btn btn-small" title="Export to Excel" style="display:inline-flex;align-items:center;padding:6px 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                </div>
                <div class="table-container">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th data-col="member_name">Name</th>
                                <th data-col="party">Party</th>
                                <th data-col="topics">Topic(s)</th>
                                <th data-col="summary">Summary</th>
                                <th data-col="forum">Forum</th>
                                <th data-col="verbatim_quote">Quote / Action</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Audit Panel -->
            <section id="audit-section">
                <div class="section-header" id="auditToggle">
                    <h2>Discarded Items</h2>
                    <span class="toggle-icon">&#9660;</span>
                </div>
                <div id="auditSummary" class="audit-summary"></div>
                <div id="auditList" class="audit-container"></div>
            </section>
        </div>

        <!-- ===== Record Tab ===== -->
        <div id="tab-record" style="display:none;">
            <section id="record-section">
                <div class="results-header">
                    <h2>Master Stakeholder List</h2>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <input type="text" id="masterSearchInput" placeholder="Search..." style="padding:5px 10px;border:1px solid var(--border);border-radius:var(--radius);font-size:0.8rem;width:160px;" oninput="filterMasterList()">
                        <button class="btn-undo disabled" id="masterUndoBtn" onclick="undoMasterDelete()" title="Undo delete" style="display:none;">&#8617;</button>
                        <button class="btn btn-small" title="Export to Excel" style="display:inline-flex;align-items:center;padding:6px 8px;" onclick="window.location.href='/api/master/export'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="masterTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Party</th>
                                <th>Type</th>
                                <th>Constituency</th>
                                <th>Topics</th>
                                <th>Priority</th>
                                <th>Notes</th>
                                <th>Activities</th>
                                <th>Latest</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="masterTableBody"></tbody>
                    </table>
                </div>
                <p id="masterEmpty" class="empty-state" style="display:none;">No stakeholders yet. Add members from scan results using the + button.</p>
            </section>
        </div>
        <!-- ===== Look Ahead Tab ===== -->
        <div id="tab-lookahead">
            <!-- Top controls: date nav + view toggle + refresh -->
            <section class="control-group-card" style="margin-bottom:16px;">
                <div class="lookahead-controls">
                    <div class="lookahead-nav">
                        <button class="btn-small" id="laPrevWeek" title="Previous week">&larr;</button>
                        <span class="lookahead-date-label" id="laDateLabel">This Week</span>
                        <button class="btn-small" id="laNextWeek" title="Next week">&rarr;</button>
                        <button class="btn-small" id="laToday" title="Jump to this week">Today</button>
                    </div>
                    <div class="lookahead-view-toggle">
                        <button class="la-view-btn active" data-view="week">Week</button>
                        <button class="la-view-btn" data-view="list">List</button>
                    </div>
                    <button class="btn-small" id="laRefreshBtn" title="Refresh from Parliament">&#8635; Refresh</button>
                </div>
            </section>

            <!-- Main area: filter sidebar + content -->
            <div class="la-main-area">
                <!-- Filter Sidebar -->
                <aside class="la-filter-sidebar">
                    <!-- Sources / Event Types -->
                    <div class="la-filter-section">
                        <span class="source-label">SOURCES</span>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="debate" checked> Debates</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="oral_questions" checked> Oral Qs</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="committee" checked> Committees</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="bill_stage" checked> Bill Stages</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="westminster_hall" checked> Westminster Hall</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="statement" checked> Statements</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-type-checkbox" data-type="general_committee" checked> Gen. Committees</label>
                    </div>

                    <!-- House -->
                    <div class="la-filter-section">
                        <span class="source-label">HOUSE</span>
                        <label class="la-filter-item"><input type="checkbox" class="la-house-checkbox" data-house="Commons" checked> Commons</label>
                        <label class="la-filter-item"><input type="checkbox" class="la-house-checkbox" data-house="Lords" checked> Lords</label>
                    </div>

                    <!-- Topics -->
                    <div class="la-filter-section">
                        <span class="source-label">TOPICS</span>
                        <label class="la-filter-item"><input type="checkbox" id="laShowAll" checked> Show all</label>
                        <label class="la-filter-item"><input type="checkbox" id="laStarredOnly"> Starred only</label>
                        <div id="laTopicCheckboxes" class="la-topic-checkboxes"></div>
                    </div>
                </aside>

                <!-- Content area -->
                <div class="la-content-area">
                    <!-- Week View -->
                    <section id="la-week-view" class="la-week-container"></section>

                    <!-- List View (hidden by default) -->
                    <section id="la-list-view" style="display:none;">
                        <div class="la-list-card">
                            <div class="table-container">
                                <table id="laListTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Event</th>
                                            <th>Type</th>
                                            <th>House</th>
                                            <th>Location</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="laListBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/app.js"></script>
    <script src="/js/datepicker.js"></script>
    <script src="/js/topics.js"></script>
    <script src="/js/scanner.js"></script>
    <script src="/js/results.js"></script>
    <script src="/js/master.js"></script>
    <script src="/js/lookahead.js"></script>
</body>
</html>
